# セキュリティ設計書

本文書はアプリのセキュリティ設計を示す

## SSL/TLS

自己署名証明書によりサーバ・クライアント間でSSL/TLSを適用した暗号化通信を行う

## 認証

本アプリではパスワードによる認証を実施する

### パスワードポリシー

- 8文字以上
- 大文字と小文字の混在必須
- 数字の含有必須
- 特殊文字の含有必須

### 認証の適用範囲

下表を除くすべての範囲に対して、ログイン認証を通過したユーザーのみアクセス可能とする。

|論理名|SecurityConfigに設定する物理名|
|:--|:--|
|一般的な静的リソースの場所|PathRequest.toStaticResources().atCommonLocations()|
|H2データベースのコンソール|PathRequest.toH2Console()|
|ホーム|/|
|カートに追加(REST API)|/cart/add|
|カートから削除(REST API)|/cart/remove|
|カートを閲覧|/cart/view|
|ログイン|/login|
|ユーザー新規登録|/signup|
|共通エラー画面|/error|

### ログアウト処理

ログアウト時、クリーンアップアクションを実行する。

## パスワードの保管

パスワードは平文保存しない。Spring Security付属のPasswordEncoderにより取得したメッセージダイジェストをデータベースに保管する。PasswordEncoderとして、BCryptPasswordEncoder を使用する。

## 認可

本アプリでは設定されたロールごとにアクセスコントロールを行う

|ロール論理名|ロール物理名|アクセス可能範囲|
|:--|:--|:--|
|ユーザー|USER|商品検索画面、カート、支払方法選択画面、購入確認画面、購入完了画面|
|管理者|ADMIN|すべての画面|

## CSRF 対策

本アプリではCSRF対策を実施する。POST要求時にクライアントからサーバへCSRFトークンを送付することにより対策する。
